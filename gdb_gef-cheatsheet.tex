\documentclass[a4paper,landscape]{article}
\usepackage[T1]{fontenc}
\usepackage{lmodern}
\usepackage[bookmarks=true,colorlinks=true,linkcolor=black,citecolor=black,filecolor=black,urlcolor=black]{hyperref}
\usepackage{multicol}
\usepackage{geometry}
\geometry{top=1cm,left=1cm,right=1cm,bottom=1cm}
\pagestyle{empty}
\usepackage{color,soul}

% Redefine section commands to use less space
\makeatletter
\renewcommand{\section}{\@startsection{section}{1}{0mm}%
                                {-1ex plus -.5ex minus -.2ex}%
                                {0.5ex plus .2ex}%x
                                {\normalfont\large\bfseries}}
\renewcommand{\subsection}{\@startsection{subsection}{2}{0mm}%
                                {-1explus -.5ex minus -.2ex}%
                                {0.5ex plus .2ex}%
                                {\normalfont\normalsize\bfseries}}
\renewcommand{\subsubsection}{\@startsection{subsubsection}{3}{0mm}%
                                {-1ex plus -.5ex minus -.2ex}%
                                {1ex plus .2ex}%
                                {\normalfont\small\bfseries}}
\makeatother

\setcounter{secnumdepth}{0} % Don't print section numbers
\setlength{\parindent}{0pt}
\setlength{\parskip}{3pt plus 0.5ex}
\begin{document}
%\raggedright
\footnotesize
\begin{multicols*}{3}
% multicol parameters
% These lengths are set only within the two main columns
%\setlength{\columnseprule}{0.25pt}
\setlength{\premulticols}{1pt}
\setlength{\postmulticols}{1pt}
\setlength{\multicolsep}{1pt}
\setlength{\columnsep}{2pt}

\begin{center}
     \Large{\textbf{Reversing with GDB and GEF}} \\
\end{center}

\section{Starting GDB}
\hl{\texttt{gdb}\textit{ program }[\textit{core}|\textit{pid}]} \\
\hl{\texttt{gdb}\textit{ gdb-options }[\texttt{-{}-args}\textit{ program args}]}

At startup, gdb reads the following init files and executes their commands:
\texttt{/etc/gdb/gdbinit} and \texttt{\textasciitilde/.gdbinit}, plus \texttt{./.gdbinit},
if \texttt{set auto-load local-gdbinit} is set to \texttt{on}.

Some options are:\\
\begin{tabular}{@{}ll@{}}
\texttt{-q}/\texttt{-{}-quiet}/\texttt{-{}-silent} & don't print version number on startup \\
\texttt{-h}/\texttt{-{}-help} & print help \\
\texttt{-{}-tty=}\textit{TTY} & use \textit{TTY} for I/O by debugged program \\
\texttt{-{}-nh} & do not read \texttt{\textasciitilde/.gdbinit} \\
\texttt{-x}\textit{ FILE} & execute GDB commands from \textit{FILE} \\
\texttt{-ix}\textit{ FILE} & like \texttt{-x} but execute before loading inferior \\
\texttt{-ex}\textit{ CMD} & execute a single GDB command; may be \\ & used multiple times and with \texttt{-x} \\
\texttt{-iex}\textit{ CMD} & like \texttt{-ex} but before loading inferior \\
\texttt{-s}\textit{ SYMFILE} & read symbols from \textit{SYMFILE} \\
% \texttt{-{}-readnow} & fully read symbol files on first access \\
% \texttt{-{}-readnever} & do not read symbol files \\
\texttt{-{}-write} & set writing into executable and core files \\
\end{tabular}

To quit, \hl{\texttt{q}[\texttt{uit}]} or \textit{Ctrl-D}.

You can invoke commands on the standard shell by using:\\
\hl{\texttt{shell}\textit{ command-string}}
or simply: \hl{\texttt{!}\textit{command-string}}

You can abbreviate a gdb command to the first few letters of the command name, if that
abbreviation is unambiguous; and you can repeat certain gdb commands by typing just
\textit{Return}. You can also use the \textit{TAB} key to get gdb to fill out the rest of a word in a command (or to show you the alternatives available, if there is more than one possibility).

You can always ask for information on commands by using \hl{\texttt{h}[\texttt{elp}]}.

\subsection{Processes and threads}
By default, when a program forks, gdb will continue to debug the parent process and
the child process will run unimpeded.
If you want to follow the child process instead of the parent process, use the command
\hl{\texttt{set follow-fork-mode}}.
On Linux, if you want to debug both the parent and child processes, use the command
\hl{\texttt{set detach-on-fork}}.

If you issue a run command to gdb after an \texttt{exec} call executes, the new target restarts.
To restart the original program, use the \texttt{file} command with the parent executable name
as its argument. By default, after an \texttt{exec} call executes, gdb discards the symbols of the
previous executable image. You can change this behaviour with the \hl{\texttt{set follow-exec-mode}}.

gdb lets you run and debug multiple programs in a single session;
in the most general case, you can have multiple threads
of execution in each of multiple processes, launched from multiple executables.
See the manual for details.

\section{Getting information}
\hl{\texttt{i}[\texttt{nfo}]} is for describing the state of your program. For
example, you can show the arguments passed to a function with \texttt{info args};
you can get a complete list of the info sub-commands with \texttt{help info}.

You can assign the result of an expression to an environment variable with \hl{\texttt{set}}.
For example, you can set the gdb prompt to a \$-sign with \texttt{set prompt \$}.

\hl{\texttt{show}} is for describing the state of gdb itself. You can
change most of things by using the related command \texttt{set};
for example, you can control what number system is used for displays with \texttt{set
radix}, or simply inquire which is in use with \texttt{show radix}.

To display all settable parameters and their values, you can use
\texttt{show} with no arguments; you may also use \texttt{info set}: both print the same.

\section{Logging output}
Logging can be enabled/disabled with \hl{\texttt{set logging on}/\texttt{off}}. \\
\hl{\texttt{set logging file}\textit{ file}} changes the current logfile
(default: \texttt{gdb.txt}).
\hl{\texttt{show logging}} shows current logging settings; other settings are
\texttt{logging overwrite}, and
\texttt{logging redirect} to choose whether the output goes to both terminal and logfile.

\section{Starting your program}
\hl{\texttt{r}[\texttt{un}] [\textit{args}]},
\hl{\texttt{start} [\textit{args}]} and
\hl{\texttt{starti} [\textit{args}]}

\texttt{start} does the equivalent of setting a temporary breakpoint
at the beginning of \emph{main} and invoking \texttt{run}.
\texttt{starti} does the equivalent of setting a temporary breakpoint
at the first instruction of a program's execution and invoking \texttt{run}.
For programs containing an elaboration phase, \texttt{starti}
will stop execution at the start of the elaboration phase.

\textit{args} may include ``*'', or ``[...]''; they are expanded using the
shell that will start the program (specified by the \texttt{\$SHELL} environment
variable).  Input/output redirection with ``>'', ``<'', or ``>{}>'' are also allowed. \\
With no arguments these commands use arguments last specified;
to cancel previous arguments, use \hl{\texttt{set args}} without arguments.
To start the inferior without using a shell, use \hl{\texttt{set startup-with-shell off}}.

\hl{\texttt{set disable-randomization on}} (enabled by default) turns off ASLR;
you can get the same behavior by using: \\
\hl{\texttt{set exec-wrapper setarch `uname -m` -R}}.

\subsection{Environment}
\hl{\texttt{show environment} [\textit{varname}]}, \hl{\texttt{set environment varname} [\texttt{=}\textit{value}]} and \hl{\texttt{unset environment}\textit{ varname}}

The changes are for your program (and the shell gdb uses to launch it), not for gdb itself.
If your shell runs an initialization file when started non-interactively, it may affect your program.

\hl{\texttt{set cwd }[\textit{dir}]} sets the inferior's working directory to \textit{dir},
while \\ \hl{\texttt{cd }[\textit{dir}]} changes gdb working directory.

\hl{\texttt{tty}} is an alias for \texttt{set inferior-tty}, which can be used
to set the terminal terminal that will be used for future runs.

\section{Checkpoint}
On Linux gdb can save a snapshot of a program's state, called
a \emph{checkpoint}, and come back to it later.
Returning to a checkpoint effectively undoes everything that has happened in the program since the checkpoint was saved. This includes changes in memory, registers, and even
(within some limits) system state. Effectively, it is like going back in time to the moment
when the checkpoint was saved.

\hl{\texttt{checkpoint}} saves a snapshot;
\hl{\texttt{info checkpoints}} lists the checkpoints that have been saved,
while
\hl{\texttt{restart }\textit{checkpoint-id}} restores the state that was saved.
All program variables, registers, stack frames etc. will be returned to the values
that they had when the checkpoint was saved.
Note that breakpoints, gdb variables, command history etc. are not affected
by restoring a checkpoint. In general, a checkpoint only restores things that
reside in the program being debugged, not in the debugger.
Finally, \hl{\texttt{delete checkpoint}\textit{ checkpoint-id}} deletes the corresponding
checkpoint.

Returning to a previously saved checkpoint will restore the user state of the program
being debugged, plus a significant subset of the system (OS) state, including file pointers. It
won't ``un-write'' data from a file, but it will rewind the file pointer to the previous location,
so that the previously written data can be overwritten. For files opened in read mode, the
pointer will also be restored so that the previously read data can be read again.

\section{Stop and continue}
\begin{itemize}
\item \emph{breakpoints} make your program stop whenever a certain point in the program is reached.  For each breakpoint, you can add conditions to control in finer detail whether your program stops.
\hl{[\texttt{t}]\texttt{break }\textit{location} [\texttt{if} \textit{condition}]} sets a [temporary] breakpoint at the given \textit{location} [, and a given \textit{condition}]. When called without any arguments, \hl{\texttt{break}} sets a breakpoint at the next instruction to be executed in the selected stack frame.
	\begin{itemize}
	\item {}[\texttt{t}]\texttt{hbreak} \textit{args} sets [temporary] \emph{hardware} breakpoints
	\item \texttt{rbreak} [\textit{file}\texttt{:}]\textit{regex} set breakpoints on all functions [of \textit{file}] matching the regular expression \textit{regex}.
	\end{itemize}
\hl{\texttt{info break}[\texttt{points}] [\textit{list}]} prints a table of all breakpoints, watchpoints, and catchpoints (or the ones specified in \textit{list}).
\hl{\texttt{clear} \textit{location}} and \hl{\texttt{delete} [\texttt{breakpoints}] \textit{list}} delete breakpoints.

\hl{\texttt{ignore} \textit{bnum} \textit{n}} sets the ignore count of breakpoint \textit{bnum} to \textit{n} (0 to make it stop the next time breakpoint \textit{bnum} is reached).
\item \emph{watchpoints}, AKA \emph{data breakpoints}, are special breakpoints that stop your program when the value of an expression changes.
	\hl{\texttt{watch} [\texttt{-l}[\texttt{ocation}]] \textit{expr} [\texttt{thread} \textit{thread-id}]} sets a watchpoint for expression \textit{expr}.
If the command includes \textit{thread-id} argument, gdb breaks only
when the corresponding thread changes the value of expr.
Ordinarily a watchpoint respects the scope of variables in \textit{expr}; however,
\texttt{-location} tells gdb to instead watch the memory referred to
by \textit{expr}.
	\begin{itemize}
	\item \hl{\texttt{rwatch}} sets a \emph{read} watchpoint
	\item \hl{\texttt{awatch}} sets an \emph{access (i.e., read or write)} watchpoint
	\item \hl{\texttt{info watchpoints [\textit{list}]}} prints a list of watchpoints
	\end{itemize}
\item \emph{catchpoints} stop your program when a certain kind
of event occurs, such as the throwing of a C++ exception or the loading of a library.
\hl{\texttt{catch} \textit{event}} stops when \textit{event} occurs; it can be:
a C++/Ada exception event (see the manual); \texttt{exec}, \texttt{fork},
\texttt{syscall [\textit{name} | \textit{number} | \texttt{g}[\texttt{roup}]:\textit{groupname}]},
[\texttt{un}]\texttt{load} \textit{regexp}, \texttt{signal }[\textit{signal...} | \texttt{all}].
Use \hl{\texttt{set stop-on-solib-events 1}} to stop the target when a shared library is loaded or unloaded.
\item To stop when your program receives a signal, use the \hl{\texttt{handle}} command
\end{itemize}
A breakpoint, watchpoint, or catchpoint can have any of several different states of enablement:
\begin{itemize}
\item Enabled --- \hl{\texttt{enable} [\texttt{breakpoints}] [\textit{list}]}
\item Disabled --- \hl{\texttt{disable} [\texttt{breakpoints}] [\textit{list}]}
\item Enabled once --- \hl{\texttt{enable} [\texttt{breakpoints}] \texttt{once} [\textit{list}]}
\item Enabled for a count --- \hl{\texttt{enable} [\texttt{breakpoints}] \texttt{count} \textit{n} [\textit{list}]}
\item Enabled for deletion --- \hl{\texttt{enable} [\texttt{breakpoints}] \texttt{delete} [\textit{list}]}
\end{itemize}
\hl{\texttt{condition} \textit{bnum} [\textit{expr}]} sets or removes a condition for *point \textit{bnum}.

You can give any *point a series of commands to execute
when your program stops due to that *point; see \hl{\texttt{commands}}.

\hl{\texttt{save breakpoints} \textit{filename}} saves all current *point definitions together with their commands and ignore counts, into \textit{filename}.
To read the saved breakpoint definitions, use \hl{\texttt{source}}.

\hl{\texttt{info program}} displays information about the status of your program.

\section{Continuing and Stepping}
\hl{\texttt{c} [\texttt{continue}] [\textit{ignore-count}]}
resumes program execution; the optional argument
\textit{ignore-count} allows you to specify a further number of times to ignore a breakpoint at this location (if the execution has stopped due to a breakpoint; otherwise the argument is ignored).

To resume execution at a different place, you can use \hl{\texttt{return}} to go back to the
calling function; or \hl{\texttt{jump}} to go to an arbitrary location.

\hl{\texttt{s}[\texttt{tep}] [\textit{count}]} continue running your program until control reaches a different source line [\textit{count} times]. \hl{\texttt{n}[\texttt{ext}] [\textit{count}]} continues to the next source line in the current stack frame.

\hl{\texttt{fin}[\texttt{ish}]} continues running until just after function in the selected stack frame returns.
\hl{\texttt{u}[\texttt{ntil}]}, without arguments, continues running until a source line past the current line, in the current stack frame, is reached. It is like the next command, except that when until encounters a jump, it automatically continues execution until the program counter is greater than the address of the jump. \hl{\texttt{u}[\texttt{ntil}] \textit{location}} continue running until either the specified \textit{location} is reached, or the current stack frame returns.

\hl{\texttt{stepi}/\texttt{si} \textit{count}} and \hl{\texttt{nexti}/\texttt{ni} \textit{count}} work on machine instructions, instead of source lines.

\section{Running programs backward}

\rule{1.0\linewidth}{0.25pt}
\scriptsize
Copyright \copyright 2018 by zxgio; cheat-sheet built on \today

This cheat-sheet may be freely distributed under the terms of the GNU
General Public License; the latest version can be found at: \\
% \url{https://github.com/zxgio/r2-cheatsheet/}
\end{multicols*}
\end{document}
